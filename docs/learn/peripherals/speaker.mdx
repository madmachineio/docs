---
title: Play music with a speaker
description: Learn how to
---

# Play music with a speaker

You have tried to produce sound using a buzzer. It sounds indeed so sharp. So this time, you are going to enjoy the music played by the speaker. It provides a higher audio quality.

**Learning goals**
* Learn how a speaker produces different sounds.
* Understand the difference between buzzer and speaker.
* Have a general idea of I2S protocol.
* Know about different sound waveforms.
* Learn about audio sampling.
* Realize the difference between WAVE and MP3 files.

## ðŸ”¸Background

### What is I2S?

**I2S**, short for inter-integrated circuit sound, is specially designed for audio data transmission. It uses three wires for communication:

* **SCK** (Serial clock): or Bit Clock (BCLK), it carries the clock signal. Its clock frequency equals _Sample Rate x Bits per channel x Number of channels_.
* **FS** (Frame Sync): or Word Select (WS), it tells that the audio data being transmitted is for the right or left channel.
* **SD** (Serial data): it is used to transfer audio data. 

<img
  src={require('./img/I2S.png').default}
  alt="I2S" width="480"
/>

The SwiftIO Feather board always serves as a master device. It has two I2S interfaces: 
* one is **I2SOut**. It sends out data to other audio devices, like speakers, so the serial data line is TX, used to send data.
* the other is **I2SIn**, and the corresponding serial data line (RX) only receives audio data. It can be used with, for example, microphones to collect sound info.

## ðŸ”¸New concept

### Audio

You listen to music in everyday life, but do you know how audio is stored on your computer? Besides, there are so many different file formats, what are their difference? Let's find out more about it.


**Waveform**

The [waveforms of sound](https://pudding.cool/2018/02/waveforms/) are various. Sine, square, triangle, and sawtooth waves are four commonly-used forms. The sounds produced by them are quite different. Random combinations of different waveforms can produce really amazing sounds.  

<img
  src={require('./img/waveforms.png').default}
  alt="Waveforms" width="960"
/>

We'll talk about the sine wave in the following part and only deal with periodic waveforms. The **sine wave** is the fundamental wave. Almost all other period waveforms can be broken down into several different sine waves using Fourier Transforms.

A periodic waveform repeats the wave in a period and produces constant sound. The **frequency** measures how many times the wave repeats in a second, measured in hertz (hz). For example, the wave below repeats the minimum wave 5 times, so the frequency is 5Hz. The higher the frequency, the higher the pitch. And the frequencies of human hearing are about 20Hz to 20kHz. 

<img
  src={require('./img/sineWave.png').default}
  alt="Sine wave" width="480"
/>

**Sampling**

The audio signal is analog and the data always change with time. There are some sampling techniques to store the data digitally. Let's take a look at the one called **pulse code modulation** (PCM). Briefly speaking, it records the sound amplitudes at a regular time interval. Then the samples will be encoded into digital values. As long as the sample data are as many as possible, you could largely recreate the original audio signal. 

<img
  src={require('./img/sampling.png').default}
  alt="Sampling" width="480"
/>

**Sample rate** describes how many times the signal is sampled in one second, measured in hertz (hz). There is a known law about the sample rate: Nyquist rate. It says the sample rate should be **more than twice the frequency of the original signal**, or it may cause distortion.

**Sample depth** corresponds to the number of possible values for each sample. The common choices are 16, 24, 32-bit. The higher the sample depth, the more precise the samples can be, so the reproduced sound will be closer to the original one.

When you wear earphones to listen to music, you can hear sounds in your left and right ear. The L and R are used respectively for the **left and right channels**. If only one channel is sampled, the sound is **mono**. **Stereo** means the audio has multiple channels, usually the right and left channel, and thus needs two speakers.

As mentioned before, the maximum frequency for human hearing is about 20KHz, the sample rate should be double to recreate sounds, that is, about 40KHz. The **CD audio** is usually sampled at 44,100Hz, in other words, 44100 samples per second, which should cover almost all sounds humans can hear. And CD-quality audio usually has 2 channels with a sample depth of 16-bit. 

**Audio format**

Maybe you have heard of some audio file formats: MP3, WAV, AAC, FLAC, and so on. These formats can be divided into two types: **lossless and lossy file format**. The difference is the way audio data is stored. For example, WAV and FLAC are lossless, while MP3 and AAC are lossy. Let's have a look at the two frequently-used formats as an example: WAV and MP3.

* **WAV** (or WAVE) file stores the raw PCM data. Besides, it has a header at the beginning which tells the sampling information. Or else others cannot know how data is sampled. This format stores all original audio data, thus it is large in file size but doesn't require any decoding method to open the file.

* **MP3** files use compression algorithms to remove some of the frequencies that human ears are not sensitive to. So this quality loss is not perceptible to most listeners. Compared to the WAV file, MP3 is much smaller in size, thus it is really handy to download from the Internet. Because it uses compression algorithms, the music player needs to decode it to open the file.  

## ðŸ”¸New component

### Speaker

The working principle of the speaker is similar to the buzzer. When the current flows, the magnet field generated in the circuit cause the internal diaphragm to move back and forth, thus causing the air vibration. The air molecules vibrate and bump into each other, which leads to the sound you hear. 

The diaphragm in a buzzer can only move back and forth among determined positions. The different sounds are generated by changing the speed of vibration. However, the diaphragm inside a speaker can move to different positions according to the signal. So a speaker can produce various sounds, and the sound is of higher quality. So it is suitable to reproduce the audio signal it receives and is widely used to play music. 

<img
  src={require('./img/speaker.png').default}
  alt="Speaker" width="480"
/>

Symbol: <img
  src={require('./img/speakerSymbol.png').default}
  alt="Speaker symbol" width="80" align="center"
/>

The speaker needs an analog signal to produce sounds. But the audio signal transmitted through the I2S bus is a digital signal, which is is not the signal that the speaker requires. Thus there is an additional chip beside the speaker that can convert the digital signal to an analog signal, known as **DAC**. 

The analog signal from the DAC can only drive a headphone and is not strong enough to drive a speaker. So an **amplifier** is needed to amplify the signal for the speaker. 

The chip MAX98357 provides both two functionalities and supports I2S protocol. It has been added to the circuit to allow the speaker to play music.

This chip **needs stereo audio** and can output audio with the left channel, right channel, or both channels. However, we have configured it to only **output left channel data** when designing the circuit.


## ðŸ”¸Circuit

The speaker connects to the chip MAX98357. And the chip connects to **I2SOut0** (SYNC0, BCLK0, TX0).

<img
  src={require('./img/speakerCircuit.png').default}
  alt="Speaker circuit" width="960"
/>

<img
  src={require('./img/speakerCircuitDiagram.png').default}
  alt="Speaker circuit diagram" width="360"
/>

:::note
The circuits above are simplified versions for your reference.
:::

## ðŸ”¸API

**Class**

**`I2SOut`** - send audio data to external devices using I2S protocol. 

| Method | Explanation |
| ------ | ----------- |
| `init(_:rate:bits:`<br />`channel:mode:)` | Initialize an I2S output interface for audio devices.<br /> **Parameter:** <br />- `idName`: the specified I2SOut pin.<br />- `rate`: the sample rate of the audio. The default rate is 16000 Hz.<br />- `bits`: the sample depth of the audio, 16-bit by default.<br /> - `channel`: the audio channel settings: left, right and stereo. By default, it is `.monoLeft`.<br /> - `mode`: define when the data is sent. The `.philips` is the default mode. |
| `write(_:count:`<br />`timeout:`) | Send audio data out to devices. <br />**Parameter:** <br />- `sample`: the audio data stored in a UInt8 array. <br />- `count`: the count of data to be sent. |

## ðŸ”¸Projects


### 1. Play scales

Different waveforms can generate different sounds. In this project, you will generate a square wave and a triangle wave manually. Then play scales using two sounds.

<img
  src={require('./img/music.png').default}
  alt="Music" width="480"
/>

**Example code**

```swift title="C01S09Speaker.swift" showLineNumbers
// Import the SwiftIO library to control input and output.
import SwiftIO
// Import the MadBoard to use the id of the pins.
import MadBoard

@main
public struct C01S09Speaker {
    public static func main() {
        // Initialize the speaker using I2S communication. 
        // The default setting is 16k sample rate, 16bit sample bits.
        let speaker = I2SOut(Id.I2SOut0)

        // The frequencies of note C to B in octave 4.
        let frequency: [Float] = [
            261.626,
            293.665,
            329.628,
            349.228,
            391.995,
            440.000,
            493.883
        ]

        // Set the samples of the waveforms.
        let sampleRate = 16_000
        let rawSampleLength = 1000
        var rawSamples = [Int16](repeating: 0, count: rawSampleLength)
        var amplitude: Int16 = 10_000

        while true {

            let duration: Float = 1.0

            // Iterate through the frequencies from C to B to play a scale. 
            // The sound waveform is a square wave, so you will hear a buzzing sound.
            generateSquare(amplitude: amplitude, &rawSamples)
            for f in frequency {
                playWave(samples: rawSamples, frequency: f, duration: duration)
            } 
            sleep(ms: 1000)

            // Iterate through the frequencies from C to B to play a scale.
            // The sound waveform is a triangle wave, and the sound is much softer.
            generateTriangle(amplitude: amplitude, &rawSamples)
            for f in frequency {
                playWave(samples: rawSamples, frequency: f, duration: duration)
            } 
            sleep(ms: 1000)

            // Decrease the amplitude to lower the sound.
            // If it's smaller than zero, it restarts from 20000.
            amplitude -= 1000
            if amplitude <= 0 {
                amplitude = 10_000
            }
        }

        // Generate samples for a square wave with a specified amplitude and store them in an array.
        func generateSquare(amplitude: Int16, _ samples: inout [Int16]) {
            let count = samples.count
            for i in 0..<count / 2 {
                samples[i] = -amplitude
            }
            for i in count / 2..<count {
                samples[i] = amplitude
            }
        }

        // Generate samples for a triangle wave with a specified amplitude and store the them in an array.
        func generateTriangle(amplitude: Int16, _ samples: inout [Int16]) {
            let count = samples.count

            let step = Float(amplitude) / Float(count / 2)
            for i in 0..<count / 4 {
                samples[i] = Int16(step * Float(i))
            }
            for i in count / 4..<count / 4 * 3 {
                samples[i] = amplitude - Int16(step * Float(i))
            }
            for i in count / 4 * 3..<count {
                samples[i] = -amplitude + Int16(step * Float(i))
            }
        }

        // Send the samples over I2s bus and play the note with a specified frequency and duration.
        func playWave(samples: [Int16], frequency: Float, duration: Float) {
            let playCount = Int(duration * Float(sampleRate))
            var data = [Int16](repeating: 0, count: playCount)

            let step: Float = frequency * Float(samples.count) / Float(sampleRate)

            var volume: Float = 1.0
            let volumeStep = 1.0 / Float(playCount)

            for i in 0..<playCount {
                let pos = Int(Float(i) * step) % samples.count 
                data[i] = Int16(Float(samples[pos]) * volume)
                volume -= volumeStep
            }
            data.withUnsafeBytes { ptr in
                let u8Array = ptr.bindMemory(to: UInt8.self)
                speaker.write(Array(u8Array))
            }
        }
    }
}
```


**Code analysis**

```swift
import SwiftIO
import MadBoard
```

Import the `SwiftIO` library to set I2S communication and the `MadBoard` to use pin ids.

```swift
let speaker = I2SOut(Id.I2SOut0)
```

Initialize an `I2SOut` interface reserved for the speaker. It will have a 16k sample rate and 16-bit sample depth by default.

```swift
let frequency: [Float] = [261.626, 293.665, 329.628, 349.228, 391.995, 440.000, 493.883]
```

Store frequencies for note C, D, E, F, G, A, B in octave 4. That constitutes a scale, which will be played by the speaker.

```swift
let sampleRate = 16_000
let rawSampleLength = 1000
var rawSamples = [Int16](repeating: 0, count: rawSampleLength)
var amplitude: Int16 = 10_000
```

Define the parameters for the audio data: 

* The signal is sampled at 16000 Hz, so there will be 16000 data per second.
* `rawSampleLength` decides the count of samples of the generated waves in a period. 
* `rawSamples` stores the samples of the audio signal in a period. At first, all values are filled with 0 and the count is decided by `rawSampleLength`.
* `amplitude` is the peak value of the wave and should be positive.


```swift
func generateSquare(amplitude: Int16, _ samples: inout [Int16]) {
    let count = samples.count
    for i in 0..<count / 2 {
        samples[i] = -amplitude
    }
    for i in count / 2..<count {
        samples[i] = amplitude
    }
}
```

This newly defined function allows you to generate a periodic square wave. You only need to calculate the samples in one period. The other periods of waves will repeat these samples. The parameter `samples` needs an array to store the audio data, so it is set as `inout` to be changed inside the function. 

A square wave has only two states (0 and 1), so the calculation is quite simple. The first half samples are all negative, and samples of the second half are positive. Their values are all decided by the parameter `amplitude`.

<img
  src={require('./img/generateSquareWave.png').default}
  alt="Generate square wave" width="600"
/>


```swift
func generateTriangle(amplitude: Int16, _ samples: inout [Int16]) {
    let count = samples.count

    let step = Float(amplitude) / Float(count / 2)
    for i in 0..<count / 4 {
        samples[i] = Int16(step * Float(i))
    }
    for i in count / 4..<count / 4 * 3 {
        samples[i] = amplitude - Int16(step * Float(i))
    }
    for i in count / 4 * 3..<count {
        samples[i] = -amplitude + Int16(step * Float(i))
    }
}
```

This function is used to generate samples for a triangle wave in a period. The constant `count` is the total of audio samples. The `step` is the change between two continuous samples.

The samples change linearly and are divided into three parts: 
* At first, the samples gradually increase to the maximum (`amplitude`).
* In the second part, the samples decrease from the maximum (`amplitude`) to the minimum (minus `amplitude`). 
* In the third part, the samples go up from the minimum (minus `amplitude`).

<img
  src={require('./img/generateTriangleWave.png').default}
  alt="Generate triangle wave" width="600"
/>

```swift
func playWave(samples: [Int16], frequency: Float, duration: Float) {
    let playCount = Int(duration * Float(sampleRate))
    var data = [Int16](repeating: 0, count: playCount)

    let step: Float = frequency * Float(samples.count) / Float(sampleRate)

    var volume: Float = 1.0
    let volumeStep = 1.0 / Float(playCount)

    for i in 0..<playCount {
        let pos = Int(Float(i) * step) % samples.count 
        data[i] = Int16(Float(samples[pos]) * volume)
        volume -= volumeStep
    }
    data.withUnsafeBytes { ptr in
        let u8Array = ptr.bindMemory(to: UInt8.self)
        speaker.write(Array(u8Array))
    }
}
```

This function sends the samples to audio devices over an I2S bus.

* `playCount` calculates the total amount of samples. `sampleRate` is the amount of samples in 1s, and `duration` is a specified time in seconds. If the note duration is 2 seconds and the sample rate is 16000Hz, the sample count equals 32000. 

* The array `data` is used to store the audio data for the speaker. All elements are 0 by default, whose count equals the count of samples calculated before.

* To better understand the constant `step`, assuming a square wave that has 20 samples in a period. Its frequency is 2Hz. Therefore, there will be 40 samples in total in one second. If the audio sample rate is at 10Hz, it needs only 10 samples in one second. So you can choose some of the samples: 1 sample every 4 samples, like samples[0], samples[4]... So the step here is 20 * 2 / 10 = 4.

<img
  src={require('./img/step.png').default}
  alt="Step" width="480"
/>

* `volume` and `volumeStep` are used to reduce the volume of each note, so it sounds more natural. You could delete the statement `volume -= volumeStep` and see how it sounds. If the `playCount` is 10, the `volume` will be 1, 0,9, 0.8... for each data to fade out the sound.

* In the `for-in` loop, you will store the desired samples into the array `data`. `pos` gets the index of the sample in `samples`. In the wave above, the `pos` is 0, 4, 8, 12, 16. When `pos` equals 20, it refers to the first sample in the next period. The samples are the same with those in the first peropd, so it restarts from 0. After the samples are multiplied by volume, you get gradually decreased sound.

* Send the data using I2S communication so that the speaker plays the note.

```swift
while true {
    let duration: Float = 1.0

    generateSquare(amplitude: amplitude, &rawSamples)
    for f in frequency {
        playWave(samples: rawSamples, frequency: f, duration: duration)
    } 
    sleep(ms: 1000)

    generateTriangle(amplitude: amplitude, &rawSamples)
    for f in frequency {
        playWave(samples: rawSamples, frequency: f, duration: duration)
    } 
    sleep(ms: 1000)

    amplitude -= 1000
    if amplitude <= 0 {
        amplitude = 10_000
    }
}
```

In the while loop, the speaker will play scales over and over again.

* At first, the samples are generated from a square wave. Then use these samples to play a scale. So the sound is like what you hear from a buzzer. 
* After that, the samples are from a triangle wave. So the sound is softer and clearer.  
* The `amplitude` decreases to turn down the speaker. The sound will be lower after each while loop until it reaches the minimum. Then `amplitude` increase to the maximum and repeats the variation.




### 2. Music player

**Example code**

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs
  defaultValue="main"
  values={[
    { label: 'C01S09MusicPlayer.swift', value: 'main', },
    { label: 'Player.swift', value: 'player', },
    { label: 'Note.swift', value: 'note', },
    { label: 'Mario.swift', value: 'mario', },
  ]
}>

<TabItem value="main">

```swift showLineNumbers
import SwiftIO
import MadBoard

@main
public struct C01S09MusicPlayer {
    public static func main() {
        // The sample rate of I2SOut and Player should be the same.
        // Note: the speaker needs stereo channel but only uses the samples of left channel. 
        // And the frequencies below 200Hz may sound a little fuzzy with this speaker.
        let speaker = I2SOut(Id.I2SOut0, rate: 16_000, channel: .stereo)

        // BPM is beat count per minute. 
        // Timer signature specifies beats per bar and note value of a beat.
        let player = Player(speaker, sampleRate: 16_000)

        player.bpm = Mario.bpm
        player.timeSignature = Mario.timeSignature

        // Play the music using the tracks.
        player.playTracks(Mario.tracks, waveforms: Mario.trackWaveforms, amplitudeRatios: Mario.amplitudeRatios)

        while true {
            sleep(ms: 1000)
        }
    }
}
```
</TabItem>

<TabItem value="player">

```swift showLineNumbers
import SwiftIO

/// Play music using the given tracks.
/// The sound sample is generated based on a triangle wave and be sent using I2S protocol.
public class Player {
    public typealias NoteInfo = (note: Note, noteValue: Int)
    public typealias TimeSignature = (beatsPerBar: Int, noteValuePerBeat: Int)

    /// Beats per minute. It sets the speed of the music.
    public var bpm: Int = 60
    /// The beat count per bar and the note value for a beat.
    public var timeSignature: TimeSignature = (4,4)
    /// Set the overall note pitch. 12 half steps constitute an octave.
    public var halfStep = 0
    /// Fade in/out duration for each note in second.
    public var fadeDuration: Float = 0.01

    let amplitude = 16383
    var beatDuration: Float { 60.0 / Float(bpm) }

    var sampleRate: Float
    var speaker: I2SOut

    var buffer32 = [Int32](repeating: 0, count: 200_000)
    var buffer16 = [Int16](repeating: 0, count: 200_000)


    /// Initialize a player.
    /// - Parameters:
    ///   - speaker: An I2SOut interface.
    ///   - sampleRate: the sample count per second. It should be the same as that of I2S.
    public init(_ speaker: I2SOut, sampleRate: Float) {
        self.speaker = speaker
        self.sampleRate = sampleRate
    }

    /// Calculate and combine the data of all tracks, and then play the sound.
    ///
    /// - Parameters:
    ///   - tracks: different tracks of a piece of music. A track consists of
    ///   notes and note value. For example, note value of a quarter note is 4,
    ///   note value of a half note is 2.
    ///   - waveforms: the waveforms for each track used to generate sound samples.
    ///   - amplitudeRatios: the ratios used to control the sound loudness of each track.
    public func playTracks(
        _ tracks: [[NoteInfo]],
        waveforms: [Waveform],
        amplitudeRatios: [Float]
    ) {
        let beatCount = tracks[0].reduce(0) {
            $0 + Float(timeSignature.noteValuePerBeat) / Float($1.noteValue)
        }

        let barCount = Int(beatCount / Float(timeSignature.beatsPerBar))

        for barIndex in 0..<barCount {
            getBarData(tracks, barIndex: barIndex, waveforms: waveforms, amplitudeRatios: amplitudeRatios, data: &buffer32)

            let count = Int(Float(timeSignature.beatsPerBar) * beatDuration * sampleRate * 2)
            for i in 0..<count {
                buffer16[i] = Int16(buffer32[i] / Int32(tracks.count))
            }
            sendData(data: buffer16, count: count)
        }
    }

    /// Calculate all data of the track and play the sound.
    /// - Parameters:
    ///   - track: score of a melody in forms of notes and note value.
    ///   For example, note value of a quarter note is 4, note value of a half note is 2.
    ///   - waveform: the waveform used to generate sound samples.
    ///   - amplitudeRatio: the ratio used to control the sound loudness.
    public func playTrack(
        _ track: [NoteInfo],
        waveform: Waveform,
        amplitudeRatio: Float
    ) {
        for noteInfo in track {
            playNote(noteInfo, waveform: waveform, amplitudeRatio: amplitudeRatio)
        }
    }


    /// Generate data for specified note and play the sound.
    /// - Parameters:
    ///   - noteInfo: the notes and its note value.
    ///   - waveform: the waveform used to generate sound samples.
    ///   - amplitudeRatio: the ratio used to control the sound loudness.
    public func playNote(
        _ noteInfo: NoteInfo,
        waveform: Waveform,
        amplitudeRatio: Float
    ) {
        let duration  = calculateNoteDuration(noteInfo.noteValue)

        var frequency: Float = 0

        if noteInfo.note == .rest {
            frequency = 0
        } else {
            frequency = frequencyTable[noteInfo.note.rawValue + halfStep]!
        }

        let sampleCount = Int(duration * sampleRate)

        for i in 0..<sampleCount {
            let sample = getNoteSample(
                at: i, frequency: frequency,
                noteDuration: duration,
                waveform: waveform,
                amplitudeRatio: amplitudeRatio)

            buffer16[i * 2] = sample
            buffer16[i * 2 + 1] = sample
        }

        sendData(data: buffer16, count: sampleCount * 2)
    }
}

extension Player {
    /// Calculate data of all notes in a bar.
    func getBarData(
        _ tracks: [[NoteInfo]],
        barIndex: Int,
        waveforms: [Waveform],
        amplitudeRatios: [Float],
        data: inout [Int32]
    ) {
        for i in data.indices {
            data[i] = 0
        }

        for trackIndex in tracks.indices {
            let track = tracks[trackIndex]
            let noteIndices = getNotesInBar(at: barIndex, in: track)
            var start = 0

            for index in noteIndices {
                getNoteData(
                    noteInfo: track[index],
                    startIndex: start,
                    waveform: waveforms[trackIndex],
                    amplitudeRatio: amplitudeRatios[trackIndex],
                    data: &data)

                start += Int(calculateNoteDuration(track[index].noteValue) * sampleRate * 2)
            }
        }
    }

    /// Calculate data of a note.
    func getNoteData(
        noteInfo: NoteInfo,
        startIndex: Int,
        waveform: Waveform,
        amplitudeRatio: Float,
        data: inout [Int32]
    ) {
        guard noteInfo.noteValue > 0 else { return }

        let duration  = calculateNoteDuration(noteInfo.noteValue)

        var frequency: Float = 0
        if noteInfo.note == .rest {
            frequency = 0
        } else {
            frequency = frequencyTable[noteInfo.note.rawValue + halfStep]!
        }

        for i in 0..<Int(duration * sampleRate) {
            let sample = Int32(getNoteSample(at: i, frequency: frequency, noteDuration: duration, waveform: waveform, amplitudeRatio: amplitudeRatio))

            data[i * 2 + startIndex] += sample
            data[i * 2 + startIndex + 1] += sample
        }
    }

    /// Get the indices of notes in the track within a specified bar.
    func getNotesInBar(at barIndex: Int, in track: [NoteInfo]) -> [Int] {
        var indices: [Int] = []
        var index = 0
        var sum: Float = 0

        while Float(timeSignature.beatsPerBar * (barIndex + 1)) - sum > 0.1 && index < track.count {
            sum += Float(timeSignature.noteValuePerBeat) / Float(track[index].noteValue)

            if sum - Float(timeSignature.beatsPerBar * barIndex) > 0.1 {
                indices.append(index)
            }

            index += 1
        }

        return indices
    }

    /// Send the generated data using I2S protocol to play the sound.
    func sendData(data: [Int16], count: Int) {
        data.withUnsafeBytes { ptr in
            let u8Array = ptr.bindMemory(to: UInt8.self)
            speaker.write(Array(u8Array), count: count * 2)
        }
    }

    /// Calculate the duration of the given note value in second.
    func calculateNoteDuration(_ noteValue: Int) -> Float {
        return beatDuration * (Float(timeSignature.noteValuePerBeat) / Float(noteValue))
    }

    /// Calculate a sample at a specified index of a note.
    /// The samples within fade (in/out) duration will be reduced to get a more
    /// natural sound effect.
    func getNoteSample(
        at index: Int,
        frequency: Float,
        noteDuration: Float,
        waveform: Waveform,
        amplitudeRatio: Float
    ) -> Int16 {
        if frequency == 0 { return 0 }

        var sample: Float  = 0

        switch waveform {
        case .square:
            sample = getSquareSample(at: index, frequency: frequency, amplitudeRatio: amplitudeRatio)
        case .triangle:
            sample = getTriangleSample(at: index, frequency: frequency, amplitudeRatio: amplitudeRatio)
        }

        let fadeInEnd = Int(fadeDuration * sampleRate)
        let fadeOutStart = Int((noteDuration - fadeDuration) * sampleRate)
        let fadeSampleCount = fadeDuration * sampleRate
        let sampleCount = Int(noteDuration * sampleRate)

        switch index {
        case 0..<fadeInEnd:
            sample *= Float(index) / fadeSampleCount
        case fadeOutStart..<sampleCount:
            sample *= Float(sampleCount - index) / fadeSampleCount
        default:
            break
        }

        return Int16(sample * Float(amplitude))
    }

    /// Calculate the raw sample of a specified point from a triangle wave.
    /// It sounds much softer than square wave.
    func getTriangleSample(
        at index: Int,
        frequency: Float,
        amplitudeRatio: Float
    ) -> Float {
        let period = sampleRate / frequency

        let sawWave = Float(index) / period - Float(Int(Float(index) / period + 0.5))
        let triWave = 2 * abs(2 * sawWave) - 1

        return triWave * amplitudeRatio
    }

    /// Calculate the raw sample of a specified point from a square wave.
    /// The sound from it will sound a little sharp.
    func getSquareSample(at index: Int,
        frequency: Float,
        amplitudeRatio: Float
    ) -> Float {
        let period = Int(sampleRate / frequency)

        if index % period < period / 2 {
            return -amplitudeRatio
        } else {
            return amplitudeRatio
        }
    }
}


public enum Waveform {
    case square
    case triangle
}
```
</TabItem>

<TabItem value="note">

```swift showLineNumbers
/// The table is listed to raise note pitch more easily by changing half steps.
let frequencyTable: [Int: Float] = [
    0    :    0         ,
    1    :    27.5      ,
    2    :    29.1352   ,
    3    :    30.8677   ,
    4    :    32.7032   ,
    5    :    34.6478   ,
    6    :    36.7081   ,
    7    :    38.8909   ,
    8    :    41.2034   ,
    9    :    43.6535   ,
    10   :    46.2493   ,
    11   :    48.9994   ,
    12   :    51.9131   ,
    13   :    55        ,
    14   :    58.2705   ,
    15   :    61.7354   ,
    16   :    65.4064   ,
    17   :    69.2957   ,
    18   :    73.4162   ,
    19   :    77.7817   ,
    20   :    82.4069   ,
    21   :    87.3071   ,
    22   :    92.4986   ,
    23   :    97.9989   ,
    24   :    103.826   ,
    25   :    110       ,
    26   :    116.541   ,
    27   :    123.471   ,
    28   :    130.813   ,
    29   :    138.591   ,
    30   :    146.832   ,
    31   :    155.563   ,
    32   :    164.814   ,
    33   :    174.614   ,
    34   :    184.997   ,
    35   :    195.998   ,
    36   :    207.652   ,
    37   :    220       ,
    38   :    233.082   ,
    39   :    246.942   ,
    40   :    261.626   ,
    41   :    277.183   ,
    42   :    293.665   ,
    43   :    311.127   ,
    44   :    329.628   ,
    45   :    349.228   ,
    46   :    369.994   ,
    47   :    391.995   ,
    48   :    415.305   ,
    49   :    440       ,
    50   :    466.164   ,
    51   :    493.883   ,
    52   :    523.251   ,
    53   :    554.365   ,
    54   :    587.33    ,
    55   :    622.254   ,
    56   :    659.255   ,
    57   :    698.456   ,
    58   :    739.989   ,
    59   :    783.991   ,
    60   :    830.609   ,
    61   :    880       ,
    62   :    932.328   ,
    63   :    987.767   ,
    64   :    1046.5    ,
    65   :    1108.73   ,
    66   :    1174.66   ,
    67   :    1244.51   ,
    68   :    1318.51   ,
    69   :    1396.91   ,
    70   :    1479.98   ,
    71   :    1567.98   ,
    72   :    1661.22   ,
    73   :    1760      ,
    74   :    1864.66   ,
    75   :    1975.53   ,
    76   :    2093      ,
    77   :    2217.46   ,
    78   :    2349.32   ,
    79   :    2489.02   ,
    80   :    2637.02   ,
    81   :    2793.83   ,
    82   :    2959.96   ,
    83   :    3135.96   ,
    84   :    3322.44   ,
    85   :    3520      ,
    86   :    3729.31   ,
    87   :    3951.07   ,
    88   :    4186.01
]

public enum Note: Int {
    case    A0      =   1
    case    AS0     =   2
    case    B0      =   3
    case    C1      =   4
    case    CS1     =   5
    case    D1      =   6
    case    DS1     =   7
    case    E1      =   8
    case    F1      =   9
    case    FS1     =   10
    case    G1      =   11
    case    GS1     =   12
    case    A1      =   13
    case    AS1     =   14
    case    B1      =   15
    case    C2      =   16
    case    CS2     =   17
    case    D2      =   18
    case    DS2     =   19
    case    E2      =   20
    case    F2      =   21
    case    FS2     =   22
    case    G2      =   23
    case    GS2     =   24
    case    A2      =   25
    case    AS2     =   26
    case    B2      =   27
    case    C3      =   28
    case    CS3     =   29
    case    D3      =   30
    case    DS3     =   31
    case    E3      =   32
    case    F3      =   33
    case    FS3     =   34
    case    G3      =   35
    case    GS3     =   36
    case    A3      =   37
    case    AS3     =   38
    case    B3      =   39
    case    C4      =   40
    case    CS4     =   41
    case    D4      =   42
    case    DS4     =   43
    case    E4      =   44
    case    F4      =   45
    case    FS4     =   46
    case    G4      =   47
    case    GS4     =   48
    case    A4      =   49
    case    AS4     =   50
    case    B4      =   51
    case    C5      =   52
    case    CS5     =   53
    case    D5      =   54
    case    DS5     =   55
    case    E5      =   56
    case    F5      =   57
    case    FS5     =   58
    case    G5      =   59
    case    GS5     =   60
    case    A5      =   61
    case    AS5     =   62
    case    B5      =   63
    case    C6      =   64
    case    CS6     =   65
    case    D6      =   66
    case    DS6     =   67
    case    E6      =   68
    case    F6      =   69
    case    FS6     =   70
    case    G6      =   71
    case    GS6     =   72
    case    A6      =   73
    case    AS6     =   74
    case    B6      =   75
    case    C7      =   76
    case    CS7     =   77
    case    D7      =   78
    case    DS7     =   79
    case    E7      =   80
    case    F7      =   81
    case    FS7     =   82
    case    G7      =   83
    case    GS7     =   84
    case    A7      =   85
    case    AS7     =   86
    case    B7      =   87
    case    C8      =   88
    case    rest    =   0
}
```
</TabItem>

<TabItem value="mario">

```swift showLineNumbers
struct Mario {
    static let track0: [Player.NoteInfo] =  [
        // Bar1
        (.E5, 16),
        (.E5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C5, 16),
        (.E5, 16),
        (.rest, 16),
        (.G5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar2
        (.C5, 16),
        (.rest, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.B4, 16),
        (.rest, 16),
        (.AS4, 16),
        (.A4, 16),
        (.rest, 16),

        // Bar3
        (.G4, 12),
        (.E5, 12),
        (.G5, 12),
        (.A5, 16),
        (.rest, 16),
        (.F5, 16),
        (.G5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 8),

        // Bar4
        (.C5, 16),
        (.rest, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.B4, 16),
        (.rest, 16),
        (.AS4, 16),
        (.A4, 16),
        (.rest, 16),

        // Bar5 (3)
        (.G4, 12),
        (.E5, 12),
        (.G5, 12),
        (.A5, 16),
        (.rest, 16),
        (.F5, 16),
        (.G5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 8),

        // Bar6
        (.rest, 8),
        (.G5, 16),
        (.FS5, 16),
        (.F5, 16),
        (.DS5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.GS4, 16),
        (.A4, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.C5, 16),
        (.D5, 16),

        // Bar7
        (.rest, 8),
        (.G5, 16),
        (.FS5, 16),
        (.F5, 16),
        (.DS5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C6, 16),
        (.rest, 16),
        (.C6, 16),
        (.C6, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar8 (6)
        (.rest, 8),
        (.G5, 16),
        (.FS5, 16),
        (.F5, 16),
        (.DS5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.GS4, 16),
        (.A4, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.C5, 16),
        (.D5, 16),

        // Bar9
        (.rest, 8),
        (.DS5, 16),
        (.rest, 16),
        (.rest, 16),
        (.D5, 16),
        (.rest, 8),
        (.C5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar10 (6)
        (.rest, 8),
        (.G5, 16),
        (.FS5, 16),
        (.F5, 16),
        (.DS5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.GS4, 16),
        (.A4, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.C5, 16),
        (.D5, 16),

        // Bar11 (7)
        (.rest, 8),
        (.G5, 16),
        (.FS5, 16),
        (.F5, 16),
        (.DS5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C6, 16),
        (.rest, 16),
        (.C6, 16),
        (.C6, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar12 (6)
        (.rest, 8),
        (.G5, 16),
        (.FS5, 16),
        (.F5, 16),
        (.DS5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.GS4, 16),
        (.A4, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.C5, 16),
        (.D5, 16),

        // Bar13 (9)
        (.rest, 8),
        (.DS5, 16),
        (.rest, 16),
        (.rest, 16),
        (.D5, 16),
        (.rest, 8),
        (.C5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar14
        (.C5, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.rest, 16),
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar15
        (.C5, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.E5, 16),
        (.rest, 2),

        // Bar16 (14)
        (.C5, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.rest, 16),
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar17 (1)
        (.E5, 16),
        (.E5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C5, 16),
        (.E5, 16),
        (.rest, 16),
        (.G5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar18 (2)
        (.C5, 16),
        (.rest, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.B4, 16),
        (.rest, 16),
        (.AS4, 16),
        (.A4, 16),
        (.rest, 16),

        // Bar19 (3)
        (.G4, 12),
        (.E5, 12),
        (.G5, 12),
        (.A5, 16),
        (.rest, 16),
        (.F5, 16),
        (.G5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 8),

        // Bar20 (4)
        (.C5, 16),
        (.rest, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.B4, 16),
        (.rest, 16),
        (.AS4, 16),
        (.A4, 16),
        (.rest, 16),

        // Bar21 (3)
        (.G4, 12),
        (.E5, 12),
        (.G5, 12),
        (.A5, 16),
        (.rest, 16),
        (.F5, 16),
        (.G5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 8),

        // Bar22
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.A4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.A4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar23
        (.B4, 12),
        (.A5, 12),
        (.A5, 12),
        (.A5, 12),
        (.G5, 12),
        (.F5, 12),
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar24 (22)
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.A4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.A4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar25
        (.B4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.F5, 12),
        (.E5, 12),
        (.D5, 12),
        (.C5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar26 (22)
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.A4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.A4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar27 (23)
        (.B4, 12),
        (.A5, 12),
        (.A5, 12),
        (.A5, 12),
        (.G5, 12),
        (.F5, 12),
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar28 (22)
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.A4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.A4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar29 (25)
        (.B4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.F5, 12),
        (.E5, 12),
        (.D5, 12),
        (.C5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar30 (14)
        (.C5, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.rest, 16),
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar31 (15)
        (.C5, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.E5, 16),
        (.rest, 2),

        // Bar32 (14)
        (.C5, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.D5, 16),
        (.rest, 16),
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar33 (1)
        (.E5, 16),
        (.E5, 16),
        (.rest, 16),
        (.E5, 16),
        (.rest, 16),
        (.C5, 16),
        (.E5, 16),
        (.rest, 16),
        (.G5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar34 (22)
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.A4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.A4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar35 (23)
        (.B4, 12),
        (.A5, 12),
        (.A5, 12),
        (.A5, 12),
        (.G5, 12),
        (.F5, 12),
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar36 (22)
        (.E5, 16),
        (.C5, 16),
        (.rest, 16),
        (.G4, 16),
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.A4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.A4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar37 (25)
        (.B4, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.F5, 12),
        (.E5, 12),
        (.D5, 12),
        (.C5, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),
    ]

    static let track1: [Player.NoteInfo] = [
        // Bar1
        (.FS4, 16),
        (.FS4, 16),
        (.rest, 16),
        (.FS4, 16),
        (.rest, 16),
        (.FS4, 16),
        (.FS4, 16),
        (.rest, 16),
        (.B4, 16),
        (.rest, 16),
        (.rest, 8),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar2
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 8),
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.D4, 16),
        (.rest, 16),
        (.CS4, 16),
        (.C4, 16),
        (.rest, 16),

        // Bar3
        (.C4, 12),
        (.G4, 12),
        (.B4, 12),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.B4, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.D4, 16),
        (.rest, 8),

        // Bar4 (2)
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 8),
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.D4, 16),
        (.rest, 16),
        (.CS4, 16),
        (.C4, 16),
        (.rest, 16),

        // Bar5 (3)
        (.C4, 12),
        (.G4, 12),
        (.B4, 12),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.B4, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.D4, 16),
        (.rest, 8),

        // Bar6
        (.rest, 8),
        (.E5, 16),
        (.DS5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.G4, 16),
        (.rest, 16),
        (.C4, 16),
        (.E4, 16),
        (.F4, 16),

        // Bar7
        (.rest, 8),
        (.E5, 16),
        (.DS5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.F5, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar8 (6)
        (.rest, 8),
        (.E5, 16),
        (.DS5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.G4, 16),
        (.rest, 16),
        (.C4, 16),
        (.E4, 16),
        (.F4, 16),

        // Bar9
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.rest, 16),
        (.F4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar10 (6)
        (.rest, 8),
        (.E5, 16),
        (.DS5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.G4, 16),
        (.rest, 16),
        (.C4, 16),
        (.E4, 16),
        (.F4, 16),

        // Bar11 (7)
        (.rest, 8),
        (.E5, 16),
        (.DS5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.F5, 16),
        (.rest, 16),
        (.F5, 16),
        (.F5, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar12 (6)
        (.rest, 8),
        (.E5, 16),
        (.DS5, 16),
        (.D5, 16),
        (.B4, 16),
        (.rest, 16),
        (.C5, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.G4, 16),
        (.rest, 16),
        (.C4, 16),
        (.E4, 16),
        (.F4, 16),

        // Bar13 (9)
        (.rest, 8),
        (.GS4, 16),
        (.rest, 16),
        (.rest, 16),
        (.F4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.rest, 8),
        (.rest, 4),

        // Bar14
        (.GS4, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.AS4, 16),
        (.rest, 16),
        (.G4, 16),
        (.E4, 16),
        (.rest, 16),
        (.E4, 16),
        (.C4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar15
        (.GS4, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.AS4, 16),
        (.G4, 16),
        (.rest, 2),

        // Bar16 (14)
        (.A4, 16),
        (.A4, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.A4, 16),
        (.AS4, 16),
        (.rest, 16),
        (.G4, 16),
        (.E4, 16),
        (.rest, 16),
        (.E4, 16),
        (.C4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar17 (1)
        (.FS4, 16),
        (.FS4, 16),
        (.rest, 16),
        (.FS4, 16),
        (.rest, 16),
        (.FS4, 16),
        (.FS4, 16),
        (.rest, 16),
        (.B4, 16),
        (.rest, 16),
        (.rest, 8),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar18 (2)
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 8),
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.D4, 16),
        (.rest, 16),
        (.CS4, 16),
        (.C4, 16),
        (.rest, 16),

        // Bar19 (3)
        (.C4, 12),
        (.G4, 12),
        (.B4, 12),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.B4, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.D4, 16),
        (.rest, 8),

        // Bar20 (2)
        (.E4, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 8),
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.D4, 16),
        (.rest, 16),
        (.CS4, 16),
        (.C4, 16),
        (.rest, 16),

        // Bar21 (3)
        (.C4, 12),
        (.G4, 12),
        (.B4, 12),
        (.C5, 16),
        (.rest, 16),
        (.A4, 16),
        (.B4, 16),
        (.rest, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.F4, 16),
        (.D4, 16),
        (.rest, 8),

        // Bar22
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.F4, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.F4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar23
        (.G4, 12),
        (.F5, 12),
        (.F5, 12),
        (.F5, 12),
        (.E5, 12),
        (.D5, 12),
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.F4, 16),
        (.E4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar24 (22)
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.F4, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.F4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar25
        (.G4, 16),
        (.D5, 16),
        (.rest, 16),
        (.D5, 16),
        (.D5, 12),
        (.C5, 12),
        (.B4, 12),
        (.G4, 16),
        (.E4, 16),
        (.rest, 16),
        (.E4, 16),
        (.C4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar26 (22)
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.F4, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.F4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar27 (23)
        (.G4, 12),
        (.F5, 12),
        (.F5, 12),
        (.F5, 12),
        (.E5, 12),
        (.D5, 12),
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.F4, 16),
        (.E4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar28 (22)
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.F4, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.F4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar29 (25)
        (.G4, 16),
        (.D5, 16),
        (.rest, 16),
        (.D5, 16),
        (.D5, 12),
        (.C5, 12),
        (.B4, 12),
        (.G4, 16),
        (.E4, 16),
        (.rest, 16),
        (.E4, 16),
        (.C4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar30 (14)
        (.GS4, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.AS4, 16),
        (.rest, 16),
        (.G4, 16),
        (.E4, 16),
        (.rest, 16),
        (.E4, 16),
        (.C4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar31 (15)
        (.GS4, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.AS4, 16),
        (.G4, 16),
        (.rest, 2),

        // Bar32 (14)
        (.GS4, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.rest, 16),
        (.GS4, 16),
        (.AS4, 16),
        (.rest, 16),
        (.G4, 16),
        (.E4, 16),
        (.rest, 16),
        (.E4, 16),
        (.C4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar33 (1)
        (.FS4, 16),
        (.FS4, 16),
        (.rest, 16),
        (.FS4, 16),
        (.rest, 16),
        (.FS4, 16),
        (.FS4, 16),
        (.rest, 16),
        (.B4, 16),
        (.rest, 16),
        (.rest, 8),
        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar34 (22)
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.F4, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.F4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar35 (23)
        (.G4, 12),
        (.F5, 12),
        (.F5, 12),
        (.F5, 12),
        (.E5, 12),
        (.D5, 12),
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.F4, 16),
        (.E4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar36 (22)
        (.C5, 16),
        (.A4, 16),
        (.rest, 16),
        (.E4, 16),
        (.rest, 8),
        (.E4, 16),
        (.rest, 16),
        (.F4, 16),
        (.C5, 16),
        (.rest, 16),
        (.C5, 16),
        (.F4, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar37 (25)
        (.G4, 16),
        (.D5, 16),
        (.rest, 16),
        (.D5, 16),
        (.D5, 12),
        (.C5, 12),
        (.B4, 12),
        (.G4, 16),
        (.E4, 16),
        (.rest, 16),
        (.E4, 16),
        (.C4, 16),
        (.rest, 16),
        (.rest, 8),
    ]

    static let track2: [Player.NoteInfo] = [
        // Bar1
        (.D3, 16),
        (.D3, 16),
        (.rest, 16),
        (.D3, 16),

        (.rest, 16),
        (.D3, 16),
        (.D3, 16),
        (.rest, 16),

        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        (.G3, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar2
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),

        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar3
        (.E3, 12),
        (.C4, 12),
        (.E4, 12),

        (.F4, 16),
        (.rest, 16),
        (.D4, 16),
        (.E4, 16),

        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.A3, 16),

        (.B3, 16),
        (.G3, 16),
        (.rest, 8),

        // Bar4
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),

        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar5
        (.E3, 12),
        (.C4, 12),
        (.E4, 12),

        (.F4, 16),
        (.rest, 16),
        (.D4, 16),
        (.E4, 16),

        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.A3, 16),

        (.B3, 16),
        (.G3, 16),
        (.rest, 8),

        // Bar6
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),

        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar7
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.G3, 16),
        (.C4, 16),

        (.rest, 16),
        (.G5, 16),
        (.rest, 16),
        (.G5, 16),

        (.G5, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        // Bar8
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),

        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar9
        (.C3, 16),
        (.rest, 16),
        (.GS3, 16),
        (.rest, 16),

        (.rest, 16),
        (.AS3, 16),
        (.rest, 8),

        (.C4, 16),
        (.rest, 16),
        (.rest, 16),
        (.G3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C3, 16),
        (.rest, 16),

        // Bar10
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),

        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar11
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.G3, 16),
        (.C4, 16),

        (.rest, 16),
        (.G5, 16),
        (.rest, 16),
        (.G5, 16),

        (.G5, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        // Bar12
         (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),

        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar13
        (.C3, 16),
        (.rest, 16),
        (.GS3, 16),
        (.rest, 16),

        (.rest, 16),
        (.AS3, 16),
        (.rest, 8),

        (.C4, 16),
        (.rest, 16),
        (.rest, 16),
        (.G3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C3, 16),
        (.rest, 16),

        // Bar14
        (.FS2, 16),
        (.rest, 16),
        (.rest, 16),
        (.DS3, 16),

        (.rest, 8),
        (.GS3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C3, 16),

        (.rest, 8),
        (.F2, 16),
        (.rest, 16),

        // Bar15
        (.FS2, 16),
        (.rest, 16),
        (.rest, 16),
        (.DS3, 16),

        (.rest, 8),
        (.GS3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C3, 16),

        (.rest, 8),
        (.F2, 16),
        (.rest, 16),

        // Bar16
        (.FS2, 16),
        (.rest, 16),
        (.rest, 16),
        (.DS3, 16),

        (.rest, 8),
        (.GS3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C3, 16),

        (.rest, 8),
        (.F2, 16),
        (.rest, 16),

        // Bar17
        (.D3, 16),
        (.D3, 16),
        (.rest, 16),
        (.D3, 16),

        (.rest, 16),
        (.D3, 16),
        (.D3, 16),
        (.rest, 16),

        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        (.G3, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar18
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),
        
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar19
        (.E3, 12),
        (.C4, 12),
        (.E4, 12),

        (.F4, 16),
        (.rest, 16),
        (.D4, 16),
        (.E4, 16),

        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.A3, 16),

        (.B3, 16),
        (.G3, 16),
        (.rest, 8),

        // Bar20
        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.E3, 16),

        (.rest, 8),
        (.C3, 16),
        (.rest, 16),
        
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),
        (.G3, 16),

        (.rest, 16),
        (.FS3, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar21
        (.E3, 12),
        (.C4, 12),
        (.E4, 12),

        (.F4, 16),
        (.rest, 16),
        (.D4, 16),
        (.E4, 16),

        (.rest, 16),
        (.C4, 16),
        (.rest, 16),
        (.A3, 16),

        (.B3, 16),
        (.G3, 16),
        (.rest, 8),

        // Bar22
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.FS3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),

        (.F3, 16),
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar23
        (.D3, 16),
        (.rest, 16),
        (.rest, 16),
        (.F3, 16),

        (.G3, 16),
        (.rest, 16),
        (.B3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.G3, 16),
        (.rest, 16),

        // Bar24
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.FS3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),

        (.F3, 16),
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar25
        (.G3, 16),
        (.G3, 16),
        (.rest, 16),
        (.G3, 16),

        (.G3, 12),
        (.A3, 12),
        (.B3, 12),

        (.C4, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        (.C3, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar26
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.FS3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),

        (.F3, 16),
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar27
        (.D3, 16),
        (.rest, 16),
        (.rest, 16),
        (.F3, 16),

        (.G3, 16),
        (.rest, 16),
        (.B3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.G3, 16),
        (.rest, 16),

        // Bar28
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.FS3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),

        (.F3, 16),
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.F3, 16),
        (.rest, 16), 

        // Bar29
        (.G3, 16),
        (.G3, 16),
        (.rest, 16),
        (.G3, 16),

        (.G3, 12),
        (.A3, 12),
        (.B3, 12),

        (.C4, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        (.C3, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar30
        (.FS2, 16),
        (.rest, 16),
        (.rest, 16),
        (.DS3, 16),

        (.rest, 8),
        (.GS3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C3, 16),

        (.rest, 8),
        (.F2, 16),
        (.rest, 16),

        // Bar31
        (.FS2, 16),
        (.rest, 16),
        (.rest, 16),
        (.DS3, 16),

        (.rest, 8),
        (.GS3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C3, 16),

        (.rest, 8),
        (.F2, 16),
        (.rest, 16),

        // Bar32
        (.FS2, 16),
        (.rest, 16),
        (.rest, 16),
        (.DS3, 16),

        (.rest, 8),
        (.GS3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.rest, 16),
        (.C3, 16),

        (.rest, 8),
        (.F2, 16),
        (.rest, 16),

        // Bar33
        (.D3, 16),
        (.D3, 16),
        (.rest, 16),
        (.D3, 16),

        (.rest, 16),
        (.D3, 16),
        (.D3, 16),
        (.rest, 16),

        (.G4, 16),
        (.rest, 16),
        (.rest, 8),

        (.G3, 16),
        (.rest, 16),
        (.rest, 8),

        // Bar34
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.FS3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),

        (.F3, 16),
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar35
        (.D3, 16),
        (.rest, 16),
        (.rest, 16),
        (.F3, 16),

        (.G3, 16),
        (.rest, 16),
        (.B3, 16),
        (.rest, 16),

        (.G3, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.G3, 16),
        (.rest, 16),

        // Bar36
        (.C3, 16),
        (.rest, 16),
        (.rest, 16),
        (.FS3, 16),

        (.G3, 16),
        (.rest, 16),
        (.C4, 16),
        (.rest, 16),

        (.F3, 16),
        (.rest, 16),
        (.F3, 16),
        (.rest, 16),

        (.C4, 16),
        (.C4, 16),
        (.F3, 16),
        (.rest, 16),

        // Bar37
        (.G3, 16),
        (.G3, 16),
        (.rest, 16),
        (.G3, 16),

        (.G3, 12),
        (.A3, 12),
        (.B3, 12),

        (.C4, 16),
        (.rest, 16),
        (.G3, 16),
        (.rest, 16),

        (.C3, 16),
        (.rest, 16),
        (.rest, 8),
    ]

    static let tracks = [track0, track1, track2]
    static let trackWaveforms: [Waveform] = [.square, .square, .triangle]
    // The sound generated by square wave is much louder than that of triangle wave.
    // Besides, the $0.3 speaker in your kit doesn't have a good low-frequency response.
    // You can adjust the amplitude ratio to make it sound better.
    static let amplitudeRatios: [Float] = [0.1, 0.1, 1]

    static let bpm = 105
    static let timeSignature = (4, 4)

}
```
</TabItem>

</Tabs>
